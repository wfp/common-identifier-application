[meta]
# The application binary must support this region to allow the use of this configuration file
region="NWS"

# The version of the configuration file
version="0.1.4"

[messages]

# HTML to display as Terms And Conditions
terms_and_conditions="""
<strong>Common Identifier Application</strong>
<p>
    <i>Copyright (C) 2024 World Food Programme</i>
</p>
<p>
    This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public
    License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any
    later version.
</p>
<p>
    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the
    implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
    more details.
</p>
<p>
    You should have received a copy of the GNU General Public License along with this program. If not, see <a href="https://www.gnu.org/licenses" target="_blank">gnu.org</a>.
</p>
<p>
    World Food Programme (WFP) disclaims any responsibility for how the program is used. This Program may collect, 
    store or otherwise process personal data provided by you and/or Users. World Food Programme represents that it has 
    no access to these personal data and that such access is not technically feasible. Users are solely
    responsible for ensuring their use of the program complies with all applicable norms and regulations, including
    those on data privacy and protection, and obtaining necessary consents and security measures where required.
</p>
<p>
    Any dispute, controversy, or claim arising out of or relating to the use of the program, including the
    interpretation, application, or breach of this license, unless settled amicably, shall be finally resolved by
    arbitration pursuant to the UNCITRAL Arbitration Rules. Nothing in or relating to this license shall be deemed a
    waiver, express or implied, of any of the privileges and immunities enjoyed by World Food Programme.
</p>
"""

error_in_config="""

<p>The application encountered an error whilst attempting to load a configuration file.</p>

<p>Please contact WFP support at <a href="mailto:NWS.BuildingBlocks@wfp.org">NWS.BuildingBlocks@wfp.org</a></p>
"""

error_in_salt="""
<p>The application encountered an error whilst attempting to load your individual salt file.</p>

<p>Please contact WFP support at <a href="mailto:NWS.BuildingBlocks@wfp.org">NWS.BuildingBlocks@wfp.org</a></p>
"""

[source]
columns = [
    { name = "Individual Reference", alias = "individual_reference" },
    { name = "First Name", alias = "first_name" },
    { name = "Last Name", alias = "last_name" },
    { name = "Father First Name", alias = "father_first_name" },
    { name = "Mother First Name", alias = "mother_first_name" },
    { name = "Year of Birth", alias = "dob_year" },
    # By specifying the default when the column is missing the default value will be added
    { name = "Document Type", alias = "document_type", default="" },
    { name = "Document ID", alias = "document_id", default="" },
    { name = "Organization", alias = "organization" },
    { name = "Category", alias = "category" },
    { name = "Currency", alias = "currency" },
    { name = "Amount", alias = "amount" },
    { name = "Start (yyyyMMdd)", alias = "start" },
    { name = "End (yyyyMMdd)", alias = "end" },
]

[validations]

"*" = [
    { op = "max_field_length", value = 200 },
]

# biographic columns
individual_reference = [
    { op = "field_type", value = "str" },
    { op = "regex_match", value = "[a-zA-Z0-9!\"#$%&'()*+\\-./:;?@[\\]^_{|}~]+", message="must only consist of alphanumeric characters and supported special characters" } # TBD
]

first_name = [
    { op = "field_type", value = "str" },
    { op = "language_check", value = "Arabic", message="is not Arabic"}
]

last_name = [
    { op = "field_type", value = "str" },
    { op = "language_check", value = "Arabic", message="is not Arabic"}
]

father_first_name = [
    { op = "field_type", value = "str" },
    { op = "language_check", value = "Arabic", message="is not Arabic"}
]

mother_first_name = [
    { op = "field_type", value = "str" },
    { op = "language_check", value = "Arabic", message="is not Arabic"}
]


dob_year = [
    { op = "min_value", value = 1901 },
    { op = "max_value", value = 2024 }, # TODO: not more than current year
]

document_type = [
    { op = "field_type", value = "str" },
    { op = "options", value = [ "", "NATIONAL_ID", "PERSONAL_ID", "LOCAL_COUNCIL_CARD" ] }
]

document_id = [] # TODO: Guidance needed from cluster

# assistance columns
organization = [
    { op = "field_type", value = "str" },
    { op = "min_field_length", value = 2 },
    { op = "max_field_length", value = 10 },
    { op = "same_value_for_all_rows" },
]

category = [
    { op = "field_type", value = "str" },
    { op = "min_field_length", value = 2 },
    { op = "max_field_length", value = 15 },
    { op = "same_value_for_all_rows" }
]

currency = [
    { op = "field_type", value = "str" },
    { op = "same_value_for_all_rows" },
    { op = "regex_match", value = 'USD', message="must be USD" },
]

amount = [
    { op = "min_value", value = 1 },
    { op = "max_value", value = 20_000 },
]

start = [
    { op = "regex_match", value = '((?:19|20)\d{2}(?:0[1-9]|1[012])(?:0[1-9]|[12]\d|3[01]))', message="must be in the format of yyyyMMdd, e.g. 20240301" }, # yyyyMMdd
    { op = "date_diff", value = "+2M"},
    { op = "date_diff", value = "-12M"}
]

end = [
    { op = "regex_match", value = '((?:19|20)\d{2}(?:0[1-9]|1[012])(?:0[1-9]|[12]\d|3[01]))', message="must be in the format of yyyyMMdd, e.g. 20240301" }, # yyyyMMdd
    { op = "date_field_diff", target = "start", value="-12M", message="must be within a year of Start"},
]


[algorithm]

[algorithm.columns]
to_translate = [
    "first_name",
    "last_name",
    "father_first_name",
    "mother_first_name",
]
static = [
    "dob_year"
]
reference = [
    "document_type",
    "document_id"
]

[algorithm.hash]
strategy = "SHA256" # SHA256 | SCRYPT | ARGON2
num_iterations = 512
parallelism = 1
block_size = 8
size = 32


[algorithm.salt]
source = "FILE" # STRING | FILE
# The regular expression to validate the salt file
validator_regex = "-----BEGIN PGP PUBLIC KEY BLOCK-----[A-Za-z0-9+/=\\s]+-----END PGP PUBLIC KEY BLOCK-----"


[algorithm.salt.value]
# $APPDATA can be used to substitute the application data directory
win32 = "$APPDATA/BuildingBlocks/SYR-NWS-PROD (440E1B46) – Public.asc"
# $HOME can be used to substitute the users home directory
darwin = "$APPDATA/BuildingBlocks/SYR-NWS-PROD (440E1B46) – Public.asc"


[destination]
columns = [
    { name = "Common Identifier", alias = "USCADI" },
    { name = "Organization", alias = "organization" },
    { name = "Category", alias = "category" },
    { name = "Currency", alias = "currency" },
    { name = "Amount", alias = "amount" },
    { name = "Start (yyyyMMdd)", alias = "start" },
    { name = "End (yyyyMMdd)", alias = "end" },
    { name = "Reference Identifier", alias = "document_hash" },
]
# The postfix of the output file. Anything inside double curly braces
# will be treated as a date format string.
# FORMATTING TOKEN GUIDE: https://date-fns.org/v3.6.0/docs/lightFormat
postfix = "-OUTPUT-NWS-1.0.8-{{yyyy-MM-dd--HH-mm-ss}}"

[destination_map]
columns = [
    { name = "Individual Reference", alias = "individual_reference" },
    { name = "Common Identifier", alias = "USCADI" },
    { name = "Reference Identifier", alias = "document_hash" },
]
postfix = "-MAPPING-NWS-1.0.8-{{yyyy-MM-dd--HH-mm-ss}}"

[destination_errors]
columns = [
    { name = "Errors", alias = "errors" },
    { name = "Individual Reference", alias = "individual_reference" },
    { name = "First Name", alias = "first_name" },
    { name = "Last Name", alias = "last_name" },
    { name = "Father First Name", alias = "father_first_name" },
    { name = "Mother First Name", alias = "mother_first_name" },
    { name = "Year of Birth", alias = "dob_year" },
    { name = "Document Type", alias = "document_type" },
    { name = "Document ID", alias = "document_id" },
    { name = "Organization", alias = "organization" },
    { name = "Category", alias = "category" },
    { name = "Currency", alias = "currency" },
    { name = "Amount", alias = "amount" },
    { name = "Start (yyyyMMdd)", alias = "start" },
    { name = "End (yyyyMMdd)", alias = "end" },
]
postfix = "-ERRORS-NWS-1.0.8-{{yyyy-MM-dd--HH-mm-ss}}"


[signature]
config_signature="b400336630216cd9bda1d279bdebf8c8"