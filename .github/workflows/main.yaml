name: Main Workflow

on:
  push:
    branches: ['main', 'develop']
  pull_request:
    branches: ['main']
    types: [opened, reopened, edited]

jobs:
  SetVariables:
    runs-on: ubuntu-latest
    outputs:
      BUILD_POSTFIX: ${{ steps.setVars.outputs.BUILD_POSTFIX }}
    steps:
      - name: Set postfix to develop
        id: setVars
        run: |
          if "${{ github.ref_name }}" == "main" (
            echo BUILD_POSTFIX="" >> $ENV:GITHUB_OUTPUT
          ) else if "${{ github.ref_name }}" == "develop" (
            echo BUILD_POSTFIX="dev" >> $ENV:GITHUB_OUTPUT
          ) else (
            echo BUILD_POSTFIX="${{ github.ref_name }}" >> $ENV:GITHUB_OUTPUT
          )
  
  AlgorithmMatrix:
    needs: SetVariables
    strategy:
      fail-fast: false
      matrix:
        region: [ syria_north_west ]
        include:
          - region: syria_north_west
            regionName: NWS
            regionCode: nws
          # - region: syria
          #   regionName: GOS
          #   regionCode: gos
    uses: "./.github/workflows/test.yaml"
    with:
      buildPostfix: ${{ needs.SetVariables.outputs.BUILD_POSTFIX }}
      region: ${{ matrix.region }}
      regionName: ${{ matrix.regionName }}
      regionCode: ${{ matrix.regionCode }}
    secrets: inherit

